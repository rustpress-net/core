import{r as a,j as e,L as E,a1 as _,k as L,aC as R,b as D,y as J,q as m,w as U,E as X,X as q,ap as z}from"./index-rtSsgAPH.js";import{A as B}from"./arrow-left-DINobE5A.js";import{R as j}from"./refresh-cw-BVqTSYJG.js";import{P as H}from"./play-zm4iwQ4C.js";import{F as V}from"./filter-DMMFr9fY.js";import{R as P}from"./rotate-ccw-Ci10B_25.js";function ee(){const[h,f]=a.useState([]),[l,A]=a.useState(null),[$,M]=a.useState(!0),[i,N]=a.useState(""),[c,w]=a.useState(""),[x,O]=a.useState(!1),[s,o]=a.useState(null),[k,v]=a.useState(null),[g,n]=a.useState(1),[T,I]=a.useState(!0);a.useEffect(()=>{y(),u()},[i,c,g]);const y=async()=>{try{const t=new URLSearchParams;i&&t.append("search",i),c&&t.append("status",c),t.append("page",g.toString()),t.append("per_page","50");const r=await(await fetch(`/api/admin/functions/executions?${t}`)).json();r.success&&(f(g===1?r.data:[...h,...r.data]),I(r.data.length===50))}catch(t){console.error("Failed to fetch executions:",t)}finally{M(!1)}},u=async()=>{try{const d=await(await fetch("/api/admin/functions/stats/executions")).json();d.success&&A(d.data)}catch(t){console.error("Failed to fetch stats:",t)}},S=async t=>{v(t);try{const r=await(await fetch(`/api/admin/functions/executions/${t}/retry`,{method:"POST"})).json();r.success?(n(1),y(),u()):alert(r.error||"Failed to retry execution")}catch(d){console.error("Failed to retry execution:",d)}finally{v(null)}},p=t=>t===null?"-":t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`,b=t=>new Date(t).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}),C=t=>{switch(t){case"success":return e.jsx(L,{className:"w-4 h-4 text-green-500"});case"failed":return e.jsx(R,{className:"w-4 h-4 text-red-500"});case"pending":case"running":return e.jsx(D,{className:"w-4 h-4 text-yellow-500 animate-pulse"});default:return e.jsx(z,{className:"w-4 h-4 text-gray-400"})}},F=t=>{switch(t){case"success":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case"failed":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400";case"pending":case"running":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(E,{to:"/functions",className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800",children:e.jsx(B,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Function Executions"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Monitor function execution history"})]})]}),e.jsxs("button",{onClick:()=>{n(1),y(),u()},className:"btn btn-secondary flex items-center gap-2",children:[e.jsx(j,{className:"w-4 h-4"}),"Refresh"]})]}),l&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 dark:text-gray-400 text-sm",children:[e.jsx(_,{className:"w-4 h-4"}),"Total"]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:l.total.toLocaleString()})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-500 text-sm",children:[e.jsx(L,{className:"w-4 h-4"}),"Success"]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:l.success.toLocaleString()})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-500 text-sm",children:[e.jsx(R,{className:"w-4 h-4"}),"Failed"]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:l.failed.toLocaleString()})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-yellow-500 text-sm",children:[e.jsx(D,{className:"w-4 h-4"}),"Pending"]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:l.pending.toLocaleString()})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-500 text-sm",children:[e.jsx(H,{className:"w-4 h-4"}),"Avg Duration"]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:p(l.avg_duration_ms)})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(J,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by function name or event...",value:i,onChange:t=>{N(t.target.value),n(1)},className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("button",{onClick:()=>O(!x),className:m("btn btn-secondary flex items-center gap-2",x&&"bg-gray-100 dark:bg-gray-700"),children:[e.jsx(V,{className:"w-4 h-4"}),"Filters",e.jsx(U,{className:m("w-4 h-4 transition-transform",x&&"rotate-180")})]})]}),x&&e.jsxs("div",{className:"flex items-center gap-4 mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("select",{value:c,onChange:t=>{w(t.target.value),n(1)},className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"success",children:"Success"}),e.jsx("option",{value:"failed",children:"Failed"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"running",children:"Running"})]}),e.jsx("button",{onClick:()=>{w(""),N(""),n(1)},className:"text-sm text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:"Clear filters"})]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:$?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(j,{className:"w-8 h-8 animate-spin mx-auto text-gray-400"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"Loading executions..."})]}):h.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(_,{className:"w-12 h-12 mx-auto text-gray-400"}),e.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-900 dark:text-white",children:"No executions yet"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"Function executions will appear here."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Function"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Event"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Duration"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Started"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:h.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx(E,{to:`/functions/${t.function_id}/edit`,className:"font-medium text-gray-900 dark:text-white hover:text-primary-600",children:t.function_name})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"px-2 py-0.5 text-xs bg-gray-100 dark:bg-gray-700 rounded",children:t.event_type})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsxs("span",{className:m("inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium rounded-full",F(t.status)),children:[C(t.status),t.status]}),t.retry_count>0&&e.jsxs("span",{className:"ml-1 text-xs text-gray-400",children:["(retry ",t.retry_count,")"]})]}),e.jsx("td",{className:"px-4 py-3 text-gray-600 dark:text-gray-300",children:p(t.duration_ms)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:b(t.started_at)}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>o(t),className:"p-1.5 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",title:"View Details",children:e.jsx(X,{className:"w-4 h-4"})}),t.status==="failed"&&e.jsx("button",{onClick:()=>S(t.id),disabled:k===t.id,className:"p-1.5 text-gray-400 hover:text-blue-600 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",title:"Retry",children:k===t.id?e.jsx(j,{className:"w-4 h-4 animate-spin"}):e.jsx(P,{className:"w-4 h-4"})})]})})]},t.id))})]}),T&&e.jsx("div",{className:"p-4 text-center border-t border-gray-200 dark:border-gray-700",children:e.jsx("button",{onClick:()=>n(g+1),className:"btn btn-secondary",children:"Load More"})})]})}),s&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white dark:bg-gray-800 px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Execution Details"}),e.jsx("button",{onClick:()=>o(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx(q,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:m("inline-flex items-center gap-2 px-3 py-1.5 text-sm font-medium rounded-full",F(s.status)),children:[C(s.status),s.status]}),e.jsxs("span",{className:"text-gray-500",children:["Duration: ",p(s.duration_ms)]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Function"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:s.function_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Event"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:s.event_type})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Started"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:b(s.started_at)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Completed"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:s.completed_at?b(s.completed_at):"-"})]})]}),s.error&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Error"}),e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("pre",{className:"text-sm text-red-700 dark:text-red-300 whitespace-pre-wrap",children:s.error})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Input"}),e.jsx("pre",{className:"p-3 bg-gray-50 dark:bg-gray-900 rounded-lg text-sm overflow-x-auto",children:JSON.stringify(s.input,null,2)})]}),s.output&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Output"}),e.jsx("pre",{className:"p-3 bg-gray-50 dark:bg-gray-900 rounded-lg text-sm overflow-x-auto",children:JSON.stringify(s.output,null,2)})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-white dark:bg-gray-800 px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-3",children:[s.status==="failed"&&e.jsxs("button",{onClick:()=>{S(s.id),o(null)},className:"btn btn-secondary flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),"Retry"]}),e.jsx("button",{onClick:()=>o(null),className:"btn btn-primary",children:"Close"})]})]})})]})}export{ee as default};
