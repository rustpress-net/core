import{r as s,j as e,ac as w,ap as K,q as S,a4 as V,aH as G}from"./index-rtSsgAPH.js";import{T as X}from"./table-2-roQtI1wP.js";import{D as W}from"./download-BFz00aPs.js";const Y="/api",E=`${Y}/admin/dbmanager/v1`;function ne(){const[d,m]=s.useState([]),[g,u]=s.useState(!0),[h,i]=s.useState(null),[l,C]=s.useState("sql"),[o,T]=s.useState("both"),[y,j]=s.useState(!1),[D,k]=s.useState(!1),f=s.useCallback(async()=>{var a;try{i(null);const t=await fetch(`${E}/tables`,{credentials:"include"});if(!t.ok)throw new Error(`Failed to fetch tables: ${t.statusText}`);const r=await t.json();if(r.success&&((a=r.data)!=null&&a.tables)){const p=r.data.tables.map(n=>({name:n.name,rows:n.rows,size:n.size,selected:!0}));m(p)}else throw new Error(r.error||"Failed to fetch tables")}catch(t){i(t instanceof Error?t.message:"An error occurred")}},[]);s.useEffect(()=>{(async()=>{u(!0),await f(),u(!1)})()},[f]);const[A,I]=s.useState(!0),[Z,ee]=s.useState(!1),[L,O]=s.useState(!0),[F,P]=s.useState(!0),[ae,te]=s.useState(!0),[se,re]=s.useState(!1),[R,q]=s.useState(!0),[z,U]=s.useState(","),[$,B]=s.useState(!0),[J,M]=s.useState(!0),c=d.filter(a=>a.selected),N=c.reduce((a,t)=>a+t.rows,0),v=c.reduce((a,t)=>{const r=parseFloat(t.size)||0;return a+r},0),Q=a=>{m(d.map(t=>t.name===a?{...t,selected:!t.selected}:t))},_=()=>{const a=d.every(t=>t.selected);m(d.map(t=>({...t,selected:!a})))},H=async()=>{if(c.length!==0){j(!0),k(!1),i(null);try{const a=await fetch(`${E}/export/tables`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({tables:c.map(x=>x.name),format:l,includeStructure:o==="structure"||o==="both",includeData:o==="data"||o==="both"})});if(!a.ok)throw new Error(`Export failed: ${a.statusText}`);const t=a.headers.get("Content-Disposition");let r=`rustpress_export_${new Date().toISOString().replace(/[:.]/g,"-").slice(0,19)}`;if(t){const x=t.match(/filename="?(.+)"?/);x&&(r=x[1])}else switch(l){case"sql":r+=".sql";break;case"csv":r+=".csv";break;case"json":r+=".json";break}const p=await a.blob(),n=URL.createObjectURL(p),b=document.createElement("a");b.href=n,b.download=r,b.click(),URL.revokeObjectURL(n),k(!0)}catch(a){i(a instanceof Error?a.message:"Export failed")}finally{j(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Export Data"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Export your database tables to SQL, CSV, or JSON format"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Select Tables"}),e.jsx("button",{onClick:_,className:"text-sm text-primary-600 hover:text-primary-500",children:d.every(a=>a.selected)?"Deselect All":"Select All"})]}),e.jsxs("div",{className:"space-y-2 max-h-[400px] overflow-y-auto",children:[g&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(w,{className:"w-8 h-8 text-primary-500 mx-auto mb-2 animate-spin"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Loading tables..."})]}),h&&!g&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(K,{className:"w-8 h-8 text-red-500 mx-auto mb-2"}),e.jsx("p",{className:"text-red-500 dark:text-red-400",children:h})]}),!g&&!h&&d.map(a=>e.jsxs("label",{className:S("flex items-center justify-between p-3 rounded-lg cursor-pointer transition-colors",a.selected?"bg-primary-50 dark:bg-primary-900/20 border border-primary-200 dark:border-primary-800":"bg-gray-50 dark:bg-gray-700/50 border border-transparent hover:bg-gray-100 dark:hover:bg-gray-700"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.selected,onChange:()=>Q(a.name),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:a.name})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:[a.rows.toLocaleString()," rows"]}),e.jsx("span",{children:a.size})]})]},a.name))]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[c.length," of ",d.length," tables selected"]}),e.jsxs("span",{className:"text-gray-900 dark:text-white font-medium",children:["~",v.toFixed(1)," MB, ",N.toLocaleString()," rows"]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Export Format"}),e.jsx("div",{className:"space-y-2",children:[{value:"sql",label:"SQL",desc:"PostgreSQL compatible"},{value:"csv",label:"CSV",desc:"Comma-separated values"},{value:"json",label:"JSON",desc:"JavaScript Object Notation"}].map(a=>e.jsxs("label",{className:S("flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-colors",l===a.value?"bg-primary-50 dark:bg-primary-900/20 border border-primary-200 dark:border-primary-800":"bg-gray-50 dark:bg-gray-700/50 border border-transparent hover:bg-gray-100 dark:hover:bg-gray-700"),children:[e.jsx("input",{type:"radio",name:"format",value:a.value,checked:l===a.value,onChange:t=>C(t.target.value),className:"text-primary-600 focus:ring-primary-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:a.label}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a.desc})]})]},a.value))})]}),l==="sql"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Content"}),e.jsx("div",{className:"space-y-2",children:[{value:"both",label:"Structure and Data"},{value:"structure",label:"Structure Only"},{value:"data",label:"Data Only"}].map(a=>e.jsxs("label",{className:"flex items-center gap-3 p-2",children:[e.jsx("input",{type:"radio",name:"content",value:a.value,checked:o===a.value,onChange:t=>T(t.target.value),className:"text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:a.label})]},a.value))})]}),l==="sql"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"SQL Options"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:A,onChange:a=>I(a.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Add DROP TABLE statements"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:L,onChange:a=>O(a.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Add IF NOT EXISTS"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:F,onChange:a=>P(a.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Use extended INSERTs"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:R,onChange:a=>q(a.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Disable FK checks during import"})]})]})]}),l==="csv"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"CSV Options"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Delimiter"}),e.jsxs("select",{value:z,onChange:a=>U(a.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:",",children:"Comma (,)"}),e.jsx("option",{value:";",children:"Semicolon (;)"}),e.jsx("option",{value:"\\t",children:"Tab"}),e.jsx("option",{value:"|",children:"Pipe (|)"})]})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:$,onChange:a=>B(a.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Include column headers"})]})]})]}),l==="json"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"JSON Options"}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:J,onChange:a=>M(a.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Pretty print (formatted)"})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsxs("span",{children:["Export will include ",c.length," table",c.length!==1?"s":"","(",N.toLocaleString()," rows, ~",v.toFixed(1)," MB)"]})]}),e.jsx("button",{onClick:H,disabled:c.length===0||y,className:"btn btn-primary flex items-center gap-2",children:y?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-4 h-4 animate-spin"}),"Exporting..."]}):D?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-4 h-4"}),"Export Complete"]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4"}),"Export"]})})]})]})}export{ne as default};
