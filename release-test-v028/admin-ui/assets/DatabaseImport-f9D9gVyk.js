import{r as d,j as e,q as x,F as te,$ as M,X as se,ap as P,ac as re,aH as ae,aC as le}from"./index-CyAWf64w.js";import{T as de}from"./table-2-CeRy7qae.js";import{F as oe}from"./file-B6V9JAA7.js";const ne="/api",N=`${ne}/admin/dbmanager/v1`;function ue(){var E;const[o,S]=d.useState("sql"),[c,y]=d.useState(null),[C,T]=d.useState(!1),[r,i]=d.useState(null),[p,I]=d.useState(null),[m,Q]=d.useState(""),[ie,V]=d.useState([]),[g,O]=d.useState(!0),[F,U]=d.useState(","),[B,H]=d.useState("utf-8"),[z,X]=d.useState("stop"),h=d.useRef(null),[G,K]=d.useState([]),[b,J]=d.useState({}),[D,_]=d.useState(!0),L=d.useCallback(async()=>{var t;try{const a=await fetch(`${N}/tables`,{credentials:"include"});if(!a.ok)return;const l=await a.json();if(l.success&&((t=l.data)!=null&&t.tables)){const n=l.data.tables.map(s=>s.name);K(n)}}catch{}},[]),W=d.useCallback(async t=>{var a;if(b[t])return b[t];try{const l=await fetch(`${N}/tables/${t}/columns`,{credentials:"include"});if(!l.ok)return[];const n=await l.json();if(n.success&&((a=n.data)!=null&&a.columns)){const s=n.data.columns.map(u=>({name:u.name,type:u.type}));return J(u=>({...u,[t]:s})),s}}catch{}return[]},[b]);d.useEffect(()=>{(async()=>{_(!0),await L(),_(!1)})()},[L]);const Y=async t=>{var l;const a=(l=t.target.files)==null?void 0:l[0];if(a&&(y(a),i(null),o==="csv")){const n=new FileReader;n.onload=async s=>{var q;const j=((q=s.target)==null?void 0:q.result).split(`
`).slice(0,6).map(k=>k.split(F));if(I(j),g&&j.length>0&&m){const k=j[0],$=await W(m);V(k.map(w=>{var R,A;return{csvColumn:w,dbColumn:((R=$.find(v=>v.name.toLowerCase()===w.toLowerCase()))==null?void 0:R.name)||"",type:((A=$.find(v=>v.name.toLowerCase()===w.toLowerCase()))==null?void 0:A.type)||"text"}}))}},n.readAsText(a)}},Z=t=>{var l;t.preventDefault();const a=(l=t.dataTransfer.files)==null?void 0:l[0];a&&(y(a),i(null))},ee=async()=>{if(c){T(!0),i(null);try{const t=new FormData;t.append("file",c),o==="csv"&&t.append("table",m);const l=await fetch(`${N}${o==="sql"?"/import/sql":"/import/csv"}`,{method:"POST",credentials:"include",body:t});if(!l.ok)throw new Error(`Import failed: ${l.statusText}`);const n=await l.json();if(o==="sql"){const s=n.data;s.success&&s.failed_statements===0?i({status:"success",message:"SQL file imported successfully",totalStatements:s.total_statements,successfulStatements:s.successful_statements,failedStatements:s.failed_statements}):s.successful_statements>0?i({status:"partial",message:"SQL import completed with errors",totalStatements:s.total_statements,successfulStatements:s.successful_statements,failedStatements:s.failed_statements,errors:s.errors}):i({status:"error",message:"SQL import failed",totalStatements:s.total_statements,successfulStatements:0,failedStatements:s.failed_statements,errors:s.errors})}else{const s=n.data;s.success?i({status:"success",message:`Data imported into ${m}`,rowsImported:s.rows_imported}):i({status:s.rows_imported>0?"partial":"error",message:s.rows_imported>0?"CSV import completed with errors":"CSV import failed",rowsImported:s.rows_imported,errors:s.errors})}}catch(t){i({status:"error",message:t instanceof Error?t.message:"Import failed"})}finally{T(!1)}}},f=()=>{y(null),i(null),I(null),h.current&&(h.current.value="")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Import Data"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Import SQL files or CSV data into your database"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Import Type"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx("button",{onClick:()=>{S("sql"),f()},className:x("p-4 rounded-lg border-2 text-left transition-all",o==="sql"?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:x("p-3 rounded-lg",o==="sql"?"bg-primary-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"),children:e.jsx(te,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:"SQL File"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Execute SQL statements from a .sql file"})]})]})}),e.jsx("button",{onClick:()=>{S("csv"),f()},className:x("p-4 rounded-lg border-2 text-left transition-all",o==="csv"?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:x("p-3 rounded-lg",o==="csv"?"bg-primary-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"),children:e.jsx(de,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:"CSV File"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Import data from a CSV file into a table"})]})]})})]})]}),o==="csv"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"CSV Options"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Target Table"}),e.jsxs("select",{value:m,onChange:t=>Q(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500",disabled:D,children:[e.jsx("option",{value:"",children:D?"Loading tables...":"Select a table..."}),G.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Delimiter"}),e.jsxs("select",{value:F,onChange:t=>U(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:",",children:"Comma (,)"}),e.jsx("option",{value:";",children:"Semicolon (;)"}),e.jsx("option",{value:"\\t",children:"Tab"}),e.jsx("option",{value:"|",children:"Pipe (|)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Encoding"}),e.jsxs("select",{value:B,onChange:t=>H(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"utf-8",children:"UTF-8"}),e.jsx("option",{value:"latin1",children:"Latin-1"}),e.jsx("option",{value:"utf-16",children:"UTF-16"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"On Error"}),e.jsxs("select",{value:z,onChange:t=>X(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"stop",children:"Stop import"}),e.jsx("option",{value:"skip",children:"Skip row"}),e.jsx("option",{value:"ignore",children:"Ignore errors"})]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:t=>O(t.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"First row contains column headers"})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Upload File"}),e.jsx("input",{ref:h,type:"file",accept:o==="sql"?".sql":".csv",onChange:Y,className:"hidden"}),c?e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-primary-100 dark:bg-primary-900/30 rounded-lg",children:e.jsx(oe,{className:"w-6 h-6 text-primary-600 dark:text-primary-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:c.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[(c.size/1024).toFixed(1)," KB"]})]})]}),e.jsx("button",{onClick:f,className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:e.jsx(se,{className:"w-5 h-5"})})]}):e.jsxs("div",{onClick:()=>{var t;return(t=h.current)==null?void 0:t.click()},onDragOver:t=>t.preventDefault(),onDrop:Z,className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center cursor-pointer hover:border-primary-500 transition-colors",children:[e.jsx(M,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-2",children:["Drag and drop your ",o.toUpperCase()," file here, or click to browse"]}),e.jsx("p",{className:"text-sm text-gray-400",children:"Maximum file size: 50MB"})]})]}),o==="csv"&&p&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Data Preview"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50",children:e.jsx("tr",{children:(E=p[0])==null?void 0:E.map((t,a)=>e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:g?t:`Column ${a+1}`},a))})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:p.slice(g?1:0).map((t,a)=>e.jsx("tr",{children:t.map((l,n)=>e.jsx("td",{className:"px-4 py-2 text-gray-900 dark:text-white",children:l},n))},a))})]})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-4",children:["Showing first ",Math.min(5,p.length-(g?1:0))," rows"]})]}),e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(P,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:"Important"}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-1",children:"Make sure to backup your database before importing data. This operation cannot be undone."})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:ee,disabled:!c||C||o==="csv"&&!m,className:"btn btn-primary flex items-center gap-2",children:C?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-4 h-4 animate-spin"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-4 h-4"}),"Import Data"]})})}),r&&e.jsx("div",{className:x("rounded-lg p-6",r.status==="success"&&"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800",r.status==="error"&&"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800",r.status==="partial"&&"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[r.status==="success"?e.jsx(ae,{className:"w-6 h-6 text-green-600 dark:text-green-400 flex-shrink-0"}):r.status==="error"?e.jsx(le,{className:"w-6 h-6 text-red-600 dark:text-red-400 flex-shrink-0"}):e.jsx(P,{className:"w-6 h-6 text-yellow-600 dark:text-yellow-400 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:x("font-medium",r.status==="success"&&"text-green-800 dark:text-green-200",r.status==="error"&&"text-red-800 dark:text-red-200",r.status==="partial"&&"text-yellow-800 dark:text-yellow-200"),children:r.message}),r.totalStatements!==void 0&&e.jsxs("div",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("p",{children:["Total statements: ",r.totalStatements]}),e.jsxs("p",{className:"text-green-600 dark:text-green-400",children:["Successful: ",r.successfulStatements]}),r.failedStatements!==void 0&&r.failedStatements>0&&e.jsxs("p",{className:"text-red-600 dark:text-red-400",children:["Failed: ",r.failedStatements]})]}),r.rowsImported!==void 0&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:["Rows imported: ",r.rowsImported]}),r.errors&&r.errors.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Errors:"}),e.jsx("pre",{className:"text-sm font-mono text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-900/30 rounded p-3 overflow-x-auto",children:r.errors.join(`
`)})]})]})]})})]})}export{ue as default};
