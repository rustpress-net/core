import{aF as Z,r as s,j as e,q as w,g as L,y as ee,t as P,ac as D,ap as I,a2 as ae,E as te}from"./index-CyAWf64w.js";import{R as se}from"./refresh-cw-Bhj-45gi.js";import{D as $}from"./download-DbmzKyJx.js";import{T as re}from"./table-2-CeRy7qae.js";import{K as le}from"./key-D26yMelS.js";import{E as ne}from"./ellipsis-vertical-B3Pzafli.js";import{P as ie}from"./pen-line-CQdMiJIr.js";import{C as ce}from"./copy-lfaF7_L0.js";const de="/api",O=`${de}/admin/dbmanager/v1`;function be(){const z=Z(),[x,B]=s.useState([]),[j,K]=s.useState(""),[c,Q]=s.useState("name"),[d,E]=s.useState("asc"),[m,M]=s.useState(!0),[F,R]=s.useState(!1),[g,k]=s.useState(null),[i,N]=s.useState(new Set),[p,V]=s.useState(!1),[v,W]=s.useState("all"),[h,n]=s.useState(null),[Y,C]=s.useState(!1),[y,S]=s.useState(""),[T,A]=s.useState(!1),u=s.useCallback(async()=>{var a;try{k(null);const t=new URLSearchParams;p&&t.append("showSystem","true");const r=await fetch(`${O}/tables?${t}`,{credentials:"include"});if(!r.ok)throw new Error(`Failed to fetch tables: ${r.statusText}`);const f=await r.json();if(f.success&&((a=f.data)!=null&&a.tables)){const X=f.data.tables.map(l=>({name:l.name,schema:l.schema,rows:l.rows,size:l.size,indexSize:l.index_size,hasRelations:l.has_relations,lastModified:l.last_modified||"-",type:l.type==="view"?"view":l.type==="materialized_view"?"materialized_view":"table"}));B(X)}else throw new Error(f.error||"Failed to fetch tables")}catch(t){k(t instanceof Error?t.message:"An error occurred")}},[p]);s.useEffect(()=>{(async()=>{M(!0),await u(),M(!1)})()},[u]);const _=async()=>{R(!0),await u(),R(!1)},b=a=>{c===a?E(d==="asc"?"desc":"asc"):(Q(a),E("asc"))},q=async()=>{if(y.trim()){A(!0);try{if(!(await fetch(`${O}/tables`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:y.trim(),columns:[{name:"id",type:"SERIAL",primaryKey:!0},{name:"created_at",type:"TIMESTAMP",default:"NOW()"}]})})).ok)throw new Error("Failed to create table");C(!1),S(""),await u()}catch(a){k(a instanceof Error?a.message:"Failed to create table")}finally{A(!1)}}},G=a=>{const t=new Set(i);t.has(a)?t.delete(a):t.add(a),N(t)},H=()=>{i.size===o.length?N(new Set):N(new Set(o.map(a=>a.name)))},o=x.filter(a=>!(!p&&a.name.startsWith("pg_")||v!=="all"&&a.type!==v||j&&!a.name.toLowerCase().includes(j.toLowerCase()))).sort((a,t)=>{let r=0;switch(c){case"name":r=a.name.localeCompare(t.name);break;case"rows":r=a.rows-t.rows;break;case"size":r=parseFloat(a.size)-parseFloat(t.size);break;case"lastModified":r=a.lastModified.localeCompare(t.lastModified);break}return d==="asc"?r:-r}),J=x.reduce((a,t)=>{const r=parseFloat(t.size)||0;return a+r},0),U=x.reduce((a,t)=>a+t.rows,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Database Tables"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:[x.length," tables, ",U.toLocaleString()," total rows, ~",J.toFixed(1)," MB"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:_,disabled:F,className:"btn btn-secondary flex items-center gap-2",children:[e.jsx(se,{className:w("w-4 h-4",F&&"animate-spin")}),"Refresh"]}),e.jsxs("button",{onClick:()=>C(!0),className:"btn btn-primary flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4"}),"Create Table"]})]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search tables...",value:j,onChange:a=>K(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("select",{value:v,onChange:a=>W(a.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"table",children:"Tables"}),e.jsx("option",{value:"view",children:"Views"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 whitespace-nowrap",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:a=>V(a.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),"Show system tables"]})]})]})}),i.size>0&&e.jsxs("div",{className:"bg-primary-50 dark:bg-primary-900/20 border border-primary-200 dark:border-primary-800 rounded-lg p-4 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-primary-800 dark:text-primary-200",children:[i.size," table",i.size>1?"s":""," selected"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{className:"btn btn-secondary btn-sm flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"Export"]}),e.jsxs("button",{className:"btn btn-danger btn-sm flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),"Drop"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-12 px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:i.size===o.length&&o.length>0,onChange:H,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:text-gray-700 dark:hover:text-gray-200",onClick:()=>b("name"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Table Name",c==="name"&&e.jsx("span",{className:"text-primary-600",children:d==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:text-gray-700 dark:hover:text-gray-200",onClick:()=>b("rows"),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:["Rows",c==="rows"&&e.jsx("span",{className:"text-primary-600",children:d==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:text-gray-700 dark:hover:text-gray-200",onClick:()=>b("size"),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:["Size",c==="size"&&e.jsx("span",{className:"text-primary-600",children:d==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Index Size"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:text-gray-700 dark:hover:text-gray-200",onClick:()=>b("lastModified"),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:["Last Modified",c==="lastModified"&&e.jsx("span",{className:"text-primary-600",children:d==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"w-12 px-4 py-3"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:!m&&!g&&o.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50 cursor-pointer",onClick:()=>z(`/development/database/tables/${a.name}`),children:[e.jsx("td",{className:"px-4 py-3",onClick:t=>t.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:i.has(a.name),onChange:()=>G(a.name),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:w("p-2 rounded-lg",a.type==="table"?"bg-blue-100 dark:bg-blue-900/30":a.type==="view"?"bg-purple-100 dark:bg-purple-900/30":"bg-orange-100 dark:bg-orange-900/30"),children:e.jsx(re,{className:w("w-4 h-4",a.type==="table"?"text-blue-600 dark:text-blue-400":a.type==="view"?"text-purple-600 dark:text-purple-400":"text-orange-600 dark:text-orange-400")})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:a.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a.schema})]}),a.hasRelations&&e.jsx("span",{title:"Has foreign keys",children:e.jsx(le,{className:"w-3 h-3 text-gray-400"})})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:w("inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",a.type==="table"?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400":a.type==="view"?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400":"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400"),children:a.type==="materialized_view"?"mat. view":a.type})}),e.jsx("td",{className:"px-4 py-3 text-right font-mono text-sm text-gray-900 dark:text-white",children:a.rows.toLocaleString()}),e.jsx("td",{className:"px-4 py-3 text-right font-mono text-sm text-gray-900 dark:text-white",children:a.size}),e.jsx("td",{className:"px-4 py-3 text-right font-mono text-sm text-gray-500 dark:text-gray-400",children:a.indexSize}),e.jsx("td",{className:"px-4 py-3 text-right text-sm text-gray-500 dark:text-gray-400",children:a.lastModified}),e.jsx("td",{className:"px-4 py-3",onClick:t=>t.stopPropagation(),children:e.jsx("button",{className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",onClick:t=>{t.stopPropagation(),n({table:a.name,x:t.clientX,y:t.clientY})},children:e.jsx(ne,{className:"w-4 h-4 text-gray-400"})})})]},a.name))})]})}),m&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(D,{className:"w-12 h-12 text-primary-500 mx-auto mb-4 animate-spin"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Loading tables..."})]}),g&&!m&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(I,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-red-500 dark:text-red-400 mb-4",children:g}),e.jsx("button",{onClick:_,className:"btn btn-secondary",children:"Try Again"})]}),!m&&!g&&o.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ae,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No tables found matching your criteria"})]})]}),h&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>n(null)}),e.jsxs("div",{className:"fixed z-50 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-1 min-w-[160px]",style:{left:h.x,top:h.y},children:[e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",onClick:()=>{z(`/development/database/tables/${h.table}`),n(null)},children:[e.jsx(te,{className:"w-4 h-4"}),"Browse Data"]}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",onClick:()=>n(null),children:[e.jsx(ie,{className:"w-4 h-4"}),"Edit Structure"]}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",onClick:()=>n(null),children:[e.jsx(ce,{className:"w-4 h-4"}),"Copy Name"]}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",onClick:()=>n(null),children:[e.jsx($,{className:"w-4 h-4"}),"Export"]}),e.jsx("hr",{className:"my-1 border-gray-200 dark:border-gray-700"}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-yellow-600 dark:text-yellow-400 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",onClick:()=>n(null),children:[e.jsx(I,{className:"w-4 h-4"}),"Truncate"]}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",onClick:()=>n(null),children:[e.jsx(P,{className:"w-4 h-4"}),"Drop Table"]})]})]}),Y&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Create New Table"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Table Name"}),e.jsx("input",{type:"text",value:y,onChange:a=>S(a.target.value),placeholder:"my_new_table",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"A new table will be created with default columns (id, created_at). You can add more columns after creation."})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{C(!1),S("")},className:"btn btn-secondary",disabled:T,children:"Cancel"}),e.jsx("button",{onClick:q,disabled:T||!y.trim(),className:"btn btn-primary flex items-center gap-2",children:T?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-4 h-4 animate-spin"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4"}),"Create Table"]})})]})]})})]})}export{be as default};
