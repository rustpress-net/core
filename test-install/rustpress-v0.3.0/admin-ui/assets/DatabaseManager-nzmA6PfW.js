import{r as d,j as e,q as n,ap as q,aH as w,aC as k,a1 as z,$ as A,L as h,b as E,a4 as $}from"./index-CyAWf64w.js";import{R as M}from"./refresh-cw-Bhj-45gi.js";import{S as P}from"./server-DyZOlH57.js";import{T as v}from"./table-2-CeRy7qae.js";import{H as I}from"./hard-drive-r9Wu_P_Z.js";import{A as H}from"./activity-DJoguY0w.js";import{T as L}from"./terminal--WPnilPS.js";import{D as B}from"./download-DbmzKyJx.js";import{P as N}from"./play-B_pEsgVw.js";const F="/api",p=`${F}/admin/dbmanager/v1`,U={connected:!1,type:"PostgreSQL",version:"Unknown",host:"localhost",port:5432,database:"rustpress",user:"unknown",ssl:!1,uptime:"Unknown",poolSize:0,activeConnections:0,idleConnections:0},O={totalTables:0,totalRows:0,databaseSize:"0 MB",indexSize:"0 MB",cacheHitRatio:0,avgQueryTime:0,queriesPerSecond:0,slowQueries:0},V=[{name:"Browse Tables",description:"View and manage database tables",href:"/development/database/tables",icon:v,color:"bg-blue-500"},{name:"SQL Query",description:"Execute custom SQL queries",href:"/development/database/sql",icon:L,color:"bg-purple-500"},{name:"Import Data",description:"Import SQL or CSV files",href:"/development/database/import",icon:A,color:"bg-green-500"},{name:"Export Data",description:"Export tables or query results",href:"/development/database/export",icon:B,color:"bg-orange-500"}];function te(){const[r,S]=d.useState(U),[i,C]=d.useState(O),[T,R]=d.useState([]),[y,b]=d.useState(!1),[u,D]=d.useState(!1),[G,f]=d.useState(null),c=d.useCallback(async()=>{try{const s=await fetch(`${p}/status`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")||""}`}});if(s.ok){const t=await s.json();if(t.success&&t.data){const a=t.data;S({connected:a.connected,type:a.db_type||"PostgreSQL",version:a.version,host:a.host,port:a.port,database:a.database,user:a.user,ssl:a.ssl,uptime:a.uptime,poolSize:a.pool_size,activeConnections:a.active_connections,idleConnections:a.idle_connections})}}}catch(s){console.error("Failed to fetch database status:",s)}},[]),x=d.useCallback(async()=>{try{const s=await fetch(`${p}/stats`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")||""}`}});if(s.ok){const t=await s.json();if(t.success&&t.data){const a=t.data;C({totalTables:a.total_tables,totalRows:a.total_rows,databaseSize:a.database_size,indexSize:a.index_size,cacheHitRatio:a.cache_hit_ratio,avgQueryTime:a.avg_query_time,queriesPerSecond:a.queries_per_second,slowQueries:a.slow_queries})}}}catch(s){console.error("Failed to fetch database stats:",s)}},[]),m=d.useCallback(async()=>{var s;try{const t=await fetch(`${p}/query/history?limit=10`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")||""}`}});if(t.ok){const a=await t.json();if(a.success&&((s=a.data)!=null&&s.history)){const g=a.data.history.map(l=>({id:l.id,query:l.query,executionTime:l.execution_time,rowCount:l.row_count,timestamp:Q(l.timestamp),status:l.status}));R(g)}}}catch(t){console.error("Failed to fetch query history:",t)}},[]),Q=s=>{const t=new Date(s),g=new Date().getTime()-t.getTime(),l=Math.floor(g/6e4);if(l<1)return"Just now";if(l<60)return`${l} minute${l>1?"s":""} ago`;const o=Math.floor(l/60);if(o<24)return`${o} hour${o>1?"s":""} ago`;const j=Math.floor(o/24);return`${j} day${j>1?"s":""} ago`},_=async()=>{b(!0),f(null);try{await Promise.all([c(),x(),m()])}catch{f("Failed to refresh data")}finally{b(!1)}};return d.useEffect(()=>{c(),x(),m()},[c,x,m]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Database Manager"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Manage your database tables, execute queries, and monitor performance"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:s=>D(s.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),"Read-only mode"]}),e.jsxs("button",{onClick:_,disabled:y,className:"btn btn-secondary flex items-center gap-2",children:[e.jsx(M,{className:n("w-4 h-4",y&&"animate-spin")}),"Refresh"]})]})]}),u&&e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(q,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:"Read-only mode is enabled"}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-1",children:"All write operations (INSERT, UPDATE, DELETE, DROP, etc.) are disabled. Only SELECT queries are allowed."})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-gray-500"}),"Connection Status"]}),e.jsx("div",{className:n("flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium",r.connected?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"),children:r.connected?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-4 h-4"}),"Connected"]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-4 h-4"}),"Disconnected"]})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide",children:"Database Type"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-white mt-1",children:[r.type," ",r.version]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide",children:"Host"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-white mt-1",children:[r.host,":",r.port]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide",children:"Database"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white mt-1",children:r.database})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide",children:"Uptime"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white mt-1",children:r.uptime})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Connection Pool"}),e.jsxs("span",{className:"text-gray-900 dark:text-white",children:[e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:[r.activeConnections," active"]})," / ",e.jsxs("span",{className:"text-gray-500",children:[r.idleConnections," idle"]})," / ",e.jsxs("span",{className:"font-medium",children:[r.poolSize," max"]})]})]}),e.jsx("div",{className:"mt-2 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 rounded-full transition-all",style:{width:`${r.activeConnections/r.poolSize*100}%`}})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(v,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:i.totalTables}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Tables"})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-purple-100 dark:bg-purple-900/30 rounded-lg",children:e.jsx(I,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:i.databaseSize}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Database Size"})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(z,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[i.cacheHitRatio,"%"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Cache Hit Ratio"})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-orange-100 dark:bg-orange-900/30 rounded-lg",children:e.jsx(H,{className:"w-6 h-6 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[i.avgQueryTime,"ms"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Avg Query Time"})]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Quick Actions"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:V.map(s=>e.jsxs(h,{to:s.href,className:"group flex items-start gap-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[e.jsx("div",{className:n("p-3 rounded-lg",s.color),children:e.jsx(s.icon,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:s.description})]})]},s.name))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Recent Queries"}),e.jsxs(h,{to:"/development/database/sql",className:"text-sm text-primary-600 hover:text-primary-500 dark:text-primary-400 flex items-center gap-1",children:["View all",e.jsx(N,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"space-y-3",children:T.map(s=>e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("div",{className:n("p-2 rounded-lg flex-shrink-0",s.status==="success"?"bg-green-100 dark:bg-green-900/30":"bg-red-100 dark:bg-red-900/30"),children:s.status==="success"?e.jsx(w,{className:"w-4 h-4 text-green-600 dark:text-green-400"}):e.jsx(k,{className:"w-4 h-4 text-red-600 dark:text-red-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("pre",{className:"text-sm font-mono text-gray-900 dark:text-white truncate",children:s.query}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(E,{className:"w-3 h-3"}),s.executionTime,"ms"]}),e.jsxs("span",{children:[s.rowCount??0," rows"]}),e.jsx("span",{children:s.timestamp})]})]})]},s.id))})]}),i.slowQueries>0&&e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx($,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:"Performance Notice"}),e.jsxs("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-1",children:["You have ",i.slowQueries," slow queries in the last 24 hours. Consider optimizing these queries or adding indexes."]}),e.jsxs(h,{to:"/development/database/sql?tab=slow-queries",className:"inline-flex items-center gap-1 text-sm font-medium text-yellow-800 dark:text-yellow-200 hover:text-yellow-900 dark:hover:text-yellow-100 mt-2",children:["View slow queries",e.jsx(N,{className:"w-4 h-4"})]})]})]})})]})}export{te as default};
