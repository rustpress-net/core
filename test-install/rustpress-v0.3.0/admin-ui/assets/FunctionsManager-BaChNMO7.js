import{o as O,aF as z,r as i,j as e,L as l,u as I,g as B,a1 as v,k as w,aC as H,y as J,q as y,w as U,ap as V,aa as G,t as Q,i as k,R as W,V as X,a2 as Z}from"./index-CyAWf64w.js";import{A as S}from"./activity-DJoguY0w.js";import{P as K}from"./pause-Bempr-0j.js";import{P as F}from"./play-B_pEsgVw.js";import{F as Y}from"./filter-BXFa1q17.js";import{R as C}from"./refresh-cw-Bhj-45gi.js";import{E as ee}from"./ellipsis-vertical-B3Pzafli.js";import{C as te}from"./copy-lfaF7_L0.js";import{T as ae}from"./terminal--WPnilPS.js";import{F as _}from"./file-code-5meBfg5p.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=O("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),re={javascript:e.jsx(_,{className:"w-4 h-4 text-yellow-500"}),typescript:e.jsx(_,{className:"w-4 h-4 text-blue-500"}),sql:e.jsx(Z,{className:"w-4 h-4 text-green-500"}),http_webhook:e.jsx(X,{className:"w-4 h-4 text-purple-500"}),email:e.jsx(W,{className:"w-4 h-4 text-red-500"}),slack:e.jsx(k,{className:"w-4 h-4 text-pink-500"}),discord:e.jsx(k,{className:"w-4 h-4 text-indigo-500"}),lua:e.jsx(ae,{className:"w-4 h-4 text-cyan-500"})};function pe(){const E=z(),[c,p]=i.useState([]),[n,T]=i.useState(null),[L,P]=i.useState(!0),[d,j]=i.useState(""),[o,b]=i.useState(""),[x,N]=i.useState(""),[g,D]=i.useState(!1),[f,m]=i.useState(null);i.useEffect(()=>{u(),h()},[d,o,x]);const u=async()=>{try{const t=new URLSearchParams;d&&t.append("search",d),o&&t.append("status",o),x&&t.append("runtime",x),t.append("is_template","false");const s=await(await fetch(`/api/admin/functions?${t}`)).json();s.success&&p(s.data)}catch(t){console.error("Failed to fetch functions:",t)}finally{P(!1)}},h=async()=>{try{const a=await(await fetch("/api/admin/functions/stats")).json();a.success&&T(a.data)}catch(t){console.error("Failed to fetch stats:",t)}},R=async t=>{try{const s=await(await fetch(`/api/admin/functions/${t}/toggle`,{method:"POST"})).json();s.success&&(p(c.map(r=>r.id===t?{...r,status:s.data.status}:r)),h())}catch(a){console.error("Failed to toggle status:",a)}},$=async t=>{try{const s=await(await fetch(`/api/admin/functions/${t}/duplicate`,{method:"POST"})).json();s.success&&E(`/functions/${s.data.id}/edit`)}catch(a){console.error("Failed to duplicate function:",a)}},A=async t=>{if(confirm("Are you sure you want to delete this function?"))try{(await(await fetch(`/api/admin/functions/${t}`,{method:"DELETE"})).json()).success&&(p(c.filter(r=>r.id!==t)),h())}catch(a){console.error("Failed to delete function:",a)}},M=async t=>{var a;try{const r=await(await fetch(`/api/admin/functions/${t}/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event_type:"manual_trigger",event_data:{triggered_by:"admin"}})})).json();r.success?(alert(`Execution ${r.data.status}! Duration: ${r.data.duration_ms}ms`),u(),h()):alert(`Execution failed: ${((a=r.data)==null?void 0:a.error)||r.error}`)}catch(s){console.error("Failed to execute function:",s)}},q=t=>t?new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Functions"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Create and manage event-driven functions"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(l,{to:"/functions/templates",className:"btn btn-secondary flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4"}),"Templates"]}),e.jsxs(l,{to:"/functions/executions",className:"btn btn-secondary flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4"}),"Executions"]}),e.jsxs(l,{to:"/functions/new",className:"btn btn-primary flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4"}),"New Function"]})]})]}),n&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 dark:text-gray-400 text-sm",children:[e.jsx(v,{className:"w-4 h-4"}),"Total"]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:n.total_functions})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-500 text-sm",children:[e.jsx(w,{className:"w-4 h-4"}),"Active"]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:n.active_functions})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-sm",children:[e.jsx(K,{className:"w-4 h-4"}),"Inactive"]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:n.inactive_functions})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-500 text-sm",children:[e.jsx(F,{className:"w-4 h-4"}),"Executions"]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:n.total_executions.toLocaleString()})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-500 text-sm",children:[e.jsx(w,{className:"w-4 h-4"}),"Success"]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:n.successful_executions.toLocaleString()})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-500 text-sm",children:[e.jsx(H,{className:"w-4 h-4"}),"Failed"]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:n.failed_executions.toLocaleString()})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-purple-500 text-sm",children:[e.jsx(S,{className:"w-4 h-4"}),"Success Rate"]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:[n.success_rate.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(J,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search functions...",value:d,onChange:t=>j(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("button",{onClick:()=>D(!g),className:y("btn btn-secondary flex items-center gap-2",g&&"bg-gray-100 dark:bg-gray-700"),children:[e.jsx(Y,{className:"w-4 h-4"}),"Filters",e.jsx(U,{className:y("w-4 h-4 transition-transform",g&&"rotate-180")})]}),e.jsx("button",{onClick:()=>u(),className:"btn btn-secondary",title:"Refresh",children:e.jsx(C,{className:"w-4 h-4"})})]}),g&&e.jsxs("div",{className:"flex items-center gap-4 mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("select",{value:o,onChange:t=>b(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"error",children:"Error"})]}),e.jsxs("select",{value:x,onChange:t=>N(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"",children:"All Runtimes"}),e.jsx("option",{value:"javascript",children:"JavaScript"}),e.jsx("option",{value:"typescript",children:"TypeScript"}),e.jsx("option",{value:"sql",children:"SQL"}),e.jsx("option",{value:"http_webhook",children:"HTTP Webhook"}),e.jsx("option",{value:"email",children:"Email"}),e.jsx("option",{value:"slack",children:"Slack"}),e.jsx("option",{value:"discord",children:"Discord"})]}),e.jsx("button",{onClick:()=>{b(""),N(""),j("")},className:"text-sm text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:"Clear filters"})]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:L?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(C,{className:"w-8 h-8 animate-spin mx-auto text-gray-400"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"Loading functions..."})]}):c.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(v,{className:"w-12 h-12 mx-auto text-gray-400"}),e.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-900 dark:text-white",children:"No functions yet"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"Create your first function or start from a template."}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-3",children:[e.jsx(l,{to:"/functions/new",className:"btn btn-primary",children:"Create Function"}),e.jsx(l,{to:"/functions/templates",className:"btn btn-secondary",children:"Browse Templates"})]})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Function"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Runtime"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Triggers"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Executions"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Last Run"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:c.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx(l,{to:`/functions/${t.id}/edit`,className:"font-medium text-gray-900 dark:text-white hover:text-primary-600",children:t.name}),t.description&&e.jsx("p",{className:"text-sm text-gray-500 truncate max-w-xs",children:t.description}),t.last_error&&e.jsxs("p",{className:"text-xs text-red-500 flex items-center gap-1 mt-1",children:[e.jsx(V,{className:"w-3 h-3"}),t.last_error.substring(0,50),"..."]})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[re[t.runtime]||e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300 capitalize",children:t.runtime.replace("_"," ")})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.trigger_events.slice(0,2).map(a=>e.jsx("span",{className:"px-2 py-0.5 text-xs bg-gray-100 dark:bg-gray-700 rounded",children:a},a)),t.trigger_events.length>2&&e.jsxs("span",{className:"px-2 py-0.5 text-xs bg-gray-100 dark:bg-gray-700 rounded",children:["+",t.trigger_events.length-2]})]})}),e.jsx("td",{className:"px-4 py-3 text-gray-600 dark:text-gray-300",children:t.execution_count.toLocaleString()}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:q(t.last_executed_at)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{onClick:()=>R(t.id),className:y("px-2 py-1 text-xs font-medium rounded-full",t.status==="active"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":t.status==="error"?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"),children:t.status})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>M(t.id),className:"p-1.5 text-gray-400 hover:text-green-600 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",title:"Execute",children:e.jsx(F,{className:"w-4 h-4"})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>m(f===t.id?null:t.id),className:"p-1.5 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:e.jsx(ee,{className:"w-4 h-4"})}),f===t.id&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>m(null)}),e.jsxs("div",{className:"absolute right-0 mt-1 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-1 z-20",children:[e.jsxs(l,{to:`/functions/${t.id}/edit`,className:"flex items-center gap-2 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx(se,{className:"w-4 h-4"}),"Edit"]}),e.jsxs("button",{onClick:()=>{$(t.id),m(null)},className:"flex items-center gap-2 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 w-full",children:[e.jsx(te,{className:"w-4 h-4"}),"Duplicate"]}),e.jsx("hr",{className:"my-1 border-gray-200 dark:border-gray-700"}),e.jsxs("button",{onClick:()=>{A(t.id),m(null)},className:"flex items-center gap-2 px-4 py-2 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 w-full",children:[e.jsx(Q,{className:"w-4 h-4"}),"Delete"]})]})]})]})]})})]},t.id))})]})})]})}export{pe as default};
