import{r as c,j as e,q as N,a1 as $,ap as W,a4 as ie,aH as z,aC as V,b as J,w as de,F as xe,t as me}from"./index-CyAWf64w.js";import{P as ue}from"./play-B_pEsgVw.js";import{B as F}from"./bookmark-D0784b4D.js";import{R as he}from"./rotate-ccw-CgGR76Bu.js";import{T as pe}from"./table-2-CeRy7qae.js";import{H as K}from"./history-C_-qU67c.js";import{C as ye}from"./copy-lfaF7_L0.js";import{D as ge}from"./download-DbmzKyJx.js";const Ne="/api",f=`${Ne}/admin/dbmanager/v1`,fe=new Set(["SELECT","FROM","WHERE","AND","OR","NOT","IN","LIKE","BETWEEN","INSERT","INTO","VALUES","UPDATE","SET","DELETE","CREATE","ALTER","DROP","TABLE","INDEX","VIEW","DATABASE","SCHEMA","JOIN","LEFT","RIGHT","INNER","OUTER","FULL","CROSS","ON","AS","ORDER","BY","GROUP","HAVING","LIMIT","OFFSET","UNION","ALL","DISTINCT","NULL","IS","TRUE","FALSE","ASC","DESC","PRIMARY","KEY","FOREIGN","REFERENCES","CONSTRAINT","DEFAULT","CHECK","UNIQUE","CASCADE","RESTRICT","TRUNCATE","BEGIN","COMMIT","ROLLBACK","TRANSACTION","EXPLAIN","ANALYZE","WITH","RETURNING","COALESCE","CASE","WHEN","THEN","ELSE","END","CAST","COUNT","SUM","AVG","MIN","MAX","NOW","CURRENT_TIMESTAMP","EXISTS","ANY","SOME","IF","ELSE","ISNULL","IFNULL","NULLIF","GREATEST","LEAST"]),be=new Set(["COUNT","SUM","AVG","MIN","MAX","NOW","CURRENT_TIMESTAMP","COALESCE","NULLIF","CAST","CONVERT","SUBSTRING","TRIM","UPPER","LOWER","LENGTH","CONCAT","REPLACE","ROUND","FLOOR","CEIL","ABS","DATE","TIME","TIMESTAMP","EXTRACT","DATE_PART","DATE_TRUNC","TO_CHAR","TO_DATE","STRING_AGG","ARRAY_AGG","JSON_AGG","JSONB_AGG","ROW_NUMBER","RANK","DENSE_RANK","LAG","LEAD","FIRST_VALUE","LAST_VALUE","NTILE"]),je=new Set(["INT","INTEGER","BIGINT","SMALLINT","TINYINT","DECIMAL","NUMERIC","FLOAT","REAL","DOUBLE","VARCHAR","CHAR","TEXT","BOOLEAN","BOOL","DATE","TIME","TIMESTAMP","TIMESTAMPTZ","INTERVAL","UUID","JSON","JSONB","ARRAY","BYTEA","SERIAL","BIGSERIAL","MONEY"]),we=r=>{const d=[];let s=0,x=0;for(;s<r.length;){if(r.slice(s,s+2)==="--"){let a=s+2;for(;a<r.length&&r[a]!==`
`;)a++;d.push(e.jsx("span",{className:"text-gray-500",children:r.slice(s,a)},x++)),s=a;continue}if(r.slice(s,s+2)==="/*"){let a=r.indexOf("*/",s+2);a===-1?a=r.length:a+=2,d.push(e.jsx("span",{className:"text-gray-500",children:r.slice(s,a)},x++)),s=a;continue}if(r[s]==="'"){let a=s+1;for(;a<r.length;){if(r[a]==="'"&&r[a+1]==="'"){a+=2;continue}if(r[a]==="'"){a++;break}a++}d.push(e.jsx("span",{className:"text-green-400",children:r.slice(s,a)},x++)),s=a;continue}if(r[s]==='"'){let a=s+1;for(;a<r.length&&r[a]!=='"';)a++;a<r.length&&a++,d.push(e.jsx("span",{className:"text-yellow-400",children:r.slice(s,a)},x++)),s=a;continue}if(/\d/.test(r[s])||r[s]==="."&&/\d/.test(r[s+1]||"")){let a=s,m=!1;for(;a<r.length&&(/\d/.test(r[a])||r[a]==="."&&!m);)r[a]==="."&&(m=!0),a++;d.push(e.jsx("span",{className:"text-purple-400",children:r.slice(s,a)},x++)),s=a;continue}if(/[a-zA-Z_]/.test(r[s])){let a=s;for(;a<r.length&&/[a-zA-Z0-9_]/.test(r[a]);)a++;const m=r.slice(s,a),h=m.toUpperCase();fe.has(h)?d.push(e.jsx("span",{className:"text-blue-400 font-semibold",children:m},x++)):be.has(h)?d.push(e.jsx("span",{className:"text-cyan-400",children:m},x++)):je.has(h)?d.push(e.jsx("span",{className:"text-orange-400",children:m},x++)):d.push(e.jsx("span",{className:"text-gray-100",children:m},x++)),s=a;continue}if(/[=<>!+\-*/%&|^~]/.test(r[s])){let a=s+1;for(;a<r.length&&/[=<>!]/.test(r[a]);)a++;d.push(e.jsx("span",{className:"text-pink-400",children:r.slice(s,a)},x++)),s=a;continue}if(/[(),;.]/.test(r[s])){d.push(e.jsx("span",{className:"text-gray-400",children:r[s]},x++)),s++;continue}d.push(e.jsx("span",{children:r[s]},x++)),s++}return d};function Le(){const[r,d]=c.useState(`SELECT * FROM posts
WHERE status = 'published'
ORDER BY created_at DESC
LIMIT 10;`),[s,x]=c.useState(null),[a,m]=c.useState(!1),[h,Y]=c.useState([]),[R,q]=c.useState([]),[p,E]=c.useState("result"),[b,X]=c.useState(!1),[L,j]=c.useState(null),[Z,P]=c.useState(!1),[B,y]=c.useState(null),[v,_]=c.useState(""),[ee,T]=c.useState(!1),[I,te]=c.useState(!1),H=c.useRef(null),k=c.useRef(null),w=c.useRef(null),se=t=>{const n=new Date(t),i=new Date().getTime()-n.getTime(),l=Math.floor(i/6e4);if(l<1)return"Just now";if(l<60)return`${l} minute${l>1?"s":""} ago`;const u=Math.floor(l/60);if(u<24)return`${u} hour${u>1?"s":""} ago`;const g=Math.floor(u/24);return`${g} day${g>1?"s":""} ago`},S=c.useCallback(async()=>{var t;try{const n=await fetch(`${f}/query/saved`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")||""}`}});if(n.ok){const o=await n.json();if(o.success&&((t=o.data)!=null&&t.queries)){const i=o.data.queries.map(l=>({id:l.id,name:l.name,query:l.query,createdAt:new Date(l.created_at).toLocaleDateString()}));Y(i)}}}catch(n){console.error("Failed to fetch saved queries:",n)}},[]),O=c.useCallback(async()=>{var t;try{const n=await fetch(`${f}/query/history?limit=50`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")||""}`}});if(n.ok){const o=await n.json();if(o.success&&((t=o.data)!=null&&t.history)){const i=o.data.history.map(l=>({id:l.id,query:l.query,executionTime:l.execution_time,status:l.status,timestamp:se(l.timestamp),rowCount:l.row_count}));q(i)}}}catch(n){console.error("Failed to fetch history:",n)}},[]),Q=c.useCallback(async t=>{if(!t.trim()){j(null),y(null);return}const n=t.trim().toUpperCase();if(!n.startsWith("SELECT")&&!n.startsWith("WITH")){j(null),y("Real-time explain is only available for SELECT/WITH queries");return}P(!0),y(null);try{const i=await(await fetch(`${f}/query/explain`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")||""}`},body:JSON.stringify({query:t})})).json();i.success&&i.data?(j(i.data.plan),y(null)):(j(null),y(i.error||"Failed to get explain plan"))}catch(o){j(null),y(`Network error: ${o instanceof Error?o.message:"Unknown error"}`)}P(!1)},[]);c.useEffect(()=>{if(b)return w.current&&clearTimeout(w.current),w.current=setTimeout(()=>{Q(r)},500),()=>{w.current&&clearTimeout(w.current)}},[r,b,Q]),c.useEffect(()=>{S(),O()},[S,O]);const re=t=>{const n=t.toUpperCase();return["DROP","TRUNCATE","DELETE"].some(o=>n.includes(o))},G=async()=>{if(r.trim()){if(re(r)&&!I){x({columns:[],rows:[],rowCount:0,executionTime:0,status:"error",error:'This query contains a destructive operation (DROP, TRUNCATE, or DELETE). Check the "Confirm destructive" checkbox to execute.'});return}m(!0),x(null);try{const n=await(await fetch(`${f}/query`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")||""}`},body:JSON.stringify({query:r,confirm:I})})).json();if(n.success&&n.data){const o=n.data;x({columns:o.columns||[],rows:o.rows||[],rowCount:o.row_count||0,executionTime:o.execution_time||0,status:o.status==="success"?"success":"error",error:o.error,affectedRows:o.affected_rows})}else x({columns:[],rows:[],rowCount:0,executionTime:0,status:"error",error:n.error||"Query execution failed"});await O()}catch(t){x({columns:[],rows:[],rowCount:0,executionTime:0,status:"error",error:`Network error: ${t instanceof Error?t.message:"Unknown error"}`})}m(!1),E("result")}},ae=t=>{if((t.ctrlKey||t.metaKey)&&t.key==="Enter"&&(t.preventDefault(),G()),t.key==="Tab"){t.preventDefault();const n=H.current;if(n){const o=n.selectionStart,i=n.selectionEnd,l=r.slice(0,o)+"  "+r.slice(i);d(l),setTimeout(()=>{n.selectionStart=n.selectionEnd=o+2},0)}}},ne=t=>{k.current&&(k.current.scrollTop=t.currentTarget.scrollTop,k.current.scrollLeft=t.currentTarget.scrollLeft)},oe=async()=>{if(!(!v.trim()||!r.trim()))try{const t=await fetch(`${f}/query/save`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")||""}`},body:JSON.stringify({name:v,query:r})});if(t.ok)await S(),T(!1),_("");else{const n=await t.json();console.error("Failed to save query:",n.error)}}catch(t){console.error("Failed to save query:",t)}},C=t=>{d(t)},D=t=>{if(!s||s.status==="error")return;let n="",o="",i="";switch(t){case"csv":n=[s.columns.join(","),...s.rows.map(U=>s.columns.map(M=>JSON.stringify(U[M]??"")).join(","))].join(`
`),o="query_result.csv",i="text/csv";break;case"json":n=JSON.stringify(s.rows,null,2),o="query_result.json",i="application/json";break;case"sql":n=s.rows.map(U=>{const M=s.columns.map(ce=>{const A=U[ce];return A===null?"NULL":typeof A=="string"?`'${A.replace(/'/g,"''")}'`:String(A)});return`INSERT INTO table_name (${s.columns.join(", ")}) VALUES (${M.join(", ")});`}).join(`
`),o="query_result.sql",i="text/plain";break}const l=new Blob([n],{type:i}),u=URL.createObjectURL(l),g=document.createElement("a");g.href=u,g.download=o,g.click(),URL.revokeObjectURL(u)},le=()=>{if(!s||s.status==="error")return;const t=[s.columns.join("	"),...s.rows.map(n=>s.columns.map(o=>String(n[o]??"")).join("	"))].join(`
`);navigator.clipboard.writeText(t)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"SQL Query Editor"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Execute SQL queries and browse results"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("kbd",{className:"px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs",children:"Ctrl"}),e.jsx("span",{children:"+"}),e.jsx("kbd",{className:"px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs",children:"Enter"}),e.jsx("span",{children:"to execute"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:G,disabled:a||!r.trim(),className:"btn btn-primary btn-sm flex items-center gap-2",children:[a?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(ue,{className:"w-4 h-4"}),"Execute"]}),e.jsxs("button",{onClick:()=>X(!b),className:N("btn btn-sm flex items-center gap-2",b?"btn-secondary bg-yellow-100 dark:bg-yellow-900/30":"btn-secondary"),children:[e.jsx($,{className:"w-4 h-4"}),"Explain"]}),e.jsxs("button",{onClick:()=>T(!0),disabled:!r.trim(),className:"btn btn-secondary btn-sm flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),"Save"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:I,onChange:t=>te(t.target.checked),className:"w-4 h-4 rounded border-gray-300 text-red-600 focus:ring-red-500"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(W,{className:"w-3 h-3 text-red-500"}),"Confirm destructive"]})]}),e.jsxs("button",{onClick:()=>d(""),disabled:!r,className:"btn btn-secondary btn-sm flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"}),"Clear"]})]})]}),e.jsxs("div",{className:"relative h-48 overflow-hidden",children:[e.jsxs("pre",{ref:k,"aria-hidden":"true",className:"absolute inset-0 p-4 font-mono text-sm bg-gray-900 overflow-auto pointer-events-none whitespace-pre-wrap break-words",style:{margin:0,border:"none",resize:"none",lineHeight:"1.5"},children:[we(r),e.jsx("span",{children:" "})]}),e.jsx("textarea",{ref:H,value:r,onChange:t=>d(t.target.value),onKeyDown:ae,onScroll:ne,placeholder:"Enter your SQL query here...",className:"absolute inset-0 w-full h-full p-4 font-mono text-sm bg-transparent text-transparent caret-white resize-none focus:outline-none",style:{caretColor:"#fff",lineHeight:"1.5"},spellCheck:!1}),e.jsxs("div",{className:"absolute bottom-2 right-2 text-xs text-gray-500 bg-gray-900/80 px-1 rounded z-10",children:[r.length," characters"]})]})]}),b&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-yellow-200 dark:border-yellow-800 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-yellow-200 dark:border-yellow-800 bg-yellow-50 dark:bg-yellow-900/20",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400"}),e.jsx("span",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:"Query Explain Plan"}),Z&&e.jsx("div",{className:"w-4 h-4 border-2 border-yellow-600 border-t-transparent rounded-full animate-spin"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-yellow-600 dark:text-yellow-400",children:[e.jsx(ie,{className:"w-3 h-3"}),e.jsx("span",{children:"Updates as you type (SELECT/WITH only)"})]})]}),e.jsx("div",{className:"max-h-64 overflow-auto",children:B?e.jsx("div",{className:"p-4 text-sm text-red-600 dark:text-red-400",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),e.jsx("span",{children:B})]})}):L?e.jsx("pre",{className:"p-4 text-xs font-mono text-gray-800 dark:text-gray-200 whitespace-pre-wrap",children:L.split(`
`).map((t,n)=>{var u;const o=/cost=\d+\.\d+\.\.\d+\.\d+/.test(t)&&parseFloat(((u=t.match(/cost=(\d+\.\d+)/))==null?void 0:u[1])||"0")>1e3,i=t.includes("Seq Scan"),l=t.includes("Nested Loop");return e.jsx("div",{className:N("leading-relaxed",o&&"text-red-600 dark:text-red-400 font-semibold",i&&"text-orange-600 dark:text-orange-400",l&&"text-yellow-600 dark:text-yellow-400"),children:t},n)})}):e.jsx("div",{className:"p-4 text-sm text-gray-500 dark:text-gray-400 text-center",children:r.trim()?"Analyzing query...":"Enter a SELECT or WITH query to see the explain plan"})}),L&&e.jsx("div",{className:"px-4 py-2 border-t border-yellow-200 dark:border-yellow-800 bg-yellow-50/50 dark:bg-yellow-900/10",children:e.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-red-500"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"High cost (>1000)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-orange-500"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Sequential scan"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-yellow-500"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Nested loop"})]})]})})]}),e.jsxs("div",{className:"flex items-center gap-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:()=>E("result"),className:N("px-4 py-2 text-sm font-medium border-b-2 -mb-px transition-colors",p==="result"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),"Result",s&&s.status==="success"&&e.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-gray-100 dark:bg-gray-700 rounded",children:s.rowCount})]})}),e.jsx("button",{onClick:()=>E("history"),className:N("px-4 py-2 text-sm font-medium border-b-2 -mb-px transition-colors",p==="history"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"}),"History",e.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-gray-100 dark:bg-gray-700 rounded",children:R.length})]})}),e.jsx("button",{onClick:()=>E("saved"),className:N("px-4 py-2 text-sm font-medium border-b-2 -mb-px transition-colors",p==="saved"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),"Saved Queries",e.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-gray-100 dark:bg-gray-700 rounded",children:h.length})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:[p==="result"&&e.jsx(e.Fragment,{children:a?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex items-center gap-3 text-gray-500",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-primary-600 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Executing query..."})]})}):s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[s.status==="success"?e.jsxs("div",{className:"flex items-center gap-2 text-green-600 dark:text-green-400",children:[e.jsx(z,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Query executed successfully"})]}):e.jsxs("div",{className:"flex items-center gap-2 text-red-600 dark:text-red-400",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Query failed"})]}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center gap-1",children:[e.jsx(J,{className:"w-3 h-3"}),s.executionTime.toFixed(2),"ms"]}),s.rowCount>0&&e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[s.rowCount," row",s.rowCount!==1?"s":""," returned"]}),s.affectedRows!==void 0&&e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[s.affectedRows," row",s.affectedRows!==1?"s":""," affected"]})]}),s.status==="success"&&s.rows.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:le,className:"btn btn-secondary btn-sm flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Copy"]}),e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{className:"btn btn-secondary btn-sm flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4"}),"Export",e.jsx(de,{className:"w-3 h-3"})]}),e.jsxs("div",{className:"absolute right-0 top-full mt-1 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-1 min-w-[120px] hidden group-hover:block z-10",children:[e.jsx("button",{onClick:()=>D("csv"),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700",children:"Export as CSV"}),e.jsx("button",{onClick:()=>D("json"),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700",children:"Export as JSON"}),e.jsx("button",{onClick:()=>D("sql"),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700",children:"Export as SQL"})]})]})]})]}),s.status==="error"?e.jsx("div",{className:"p-4",children:e.jsx("pre",{className:"text-sm font-mono text-red-600 dark:text-red-400 whitespace-pre-wrap",children:s.error})}):s.rows.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50",children:e.jsx("tr",{children:s.columns.map(t=>e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:t},t))})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:s.rows.map((t,n)=>e.jsx("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:s.columns.map(o=>e.jsx("td",{className:"px-4 py-2 text-sm font-mono text-gray-900 dark:text-white whitespace-nowrap",children:t[o]===null?e.jsx("span",{className:"text-gray-400 italic",children:"(NULL)"}):String(t[o])},o))},n))})]})}):e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"Query executed successfully. No rows returned."})]}):e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(xe,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Execute a query to see results"})]})}),p==="history"&&e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:R.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(K,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No query history yet"})]}):R.map(t=>e.jsx("div",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 cursor-pointer",onClick:()=>C(t.query),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("pre",{className:"text-sm font-mono text-gray-900 dark:text-white truncate",children:t.query}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:N("flex items-center gap-1",t.status==="success"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[t.status==="success"?e.jsx(z,{className:"w-3 h-3"}):e.jsx(V,{className:"w-3 h-3"}),t.status]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"w-3 h-3"}),t.executionTime,"ms"]}),t.rowCount!==void 0&&e.jsxs("span",{children:[t.rowCount," rows"]}),e.jsx("span",{children:t.timestamp})]})]}),e.jsx("button",{onClick:n=>{n.stopPropagation(),C(t.query)},className:"btn btn-secondary btn-sm",children:"Load"})]})},t.id))}),p==="saved"&&e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:h.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(F,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No saved queries yet"})]}):h.map(t=>e.jsx("div",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 cursor-pointer",onClick:()=>C(t.query),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:t.name}),e.jsx("pre",{className:"text-sm font-mono text-gray-500 dark:text-gray-400 truncate mt-1",children:t.query}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:["Saved on ",t.createdAt]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:n=>{n.stopPropagation(),C(t.query)},className:"btn btn-secondary btn-sm",children:"Load"}),e.jsx("button",{onClick:async n=>{n.stopPropagation();try{(await fetch(`${f}/query/saved/${t.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")||""}`}})).ok&&await S()}catch(o){console.error("Failed to delete query:",o)}},className:"btn btn-danger btn-sm",children:e.jsx(me,{className:"w-4 h-4"})})]})]})},t.id))})]}),ee&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:()=>T(!1)}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Save Query"}),e.jsx("input",{type:"text",placeholder:"Query name...",value:v,onChange:t=>_(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 mb-4",autoFocus:!0}),e.jsx("pre",{className:"text-sm font-mono text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-700/50 p-3 rounded-lg mb-4 max-h-32 overflow-auto",children:r}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>T(!1),className:"btn btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:oe,disabled:!v.trim(),className:"btn btn-primary",children:"Save Query"})]})]})})]})]})}export{Le as default};
